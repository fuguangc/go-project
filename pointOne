# 给定一个比特币区块，取出该区块中每笔交易的txhash，inputs(address,amount,index)和outputs(address,amount,index)、txfee，并依次打印上述信息
import requests
import json

rpc_url = "http://127.0.0.1:8332" 
rpc_user = "xiaomeiqiu1234@163.com"
rpc_password = "Zv!9tCT#wbZsz#8"

# 区块哈希
block_hash = "bitcoin-cli getblockhash 680000"

# 发送RPC请求
def rpc_request(method, params=[]):
    headers = {'content-type': 'application/json'}
    payload = json.dumps({
        "method": method,
        "params": params,
        "jsonrpc": "2.0",
        "id": 0
    })
    response = requests.post(rpc_url, headers=headers, data=payload, auth=(rpc_user, rpc_password))
    return response.json()

# 获取区块数据
block_data = rpc_request('getblock', [block_hash, 2]) 

# 提取并打印每笔交易的信息
for tx in block_data['result']['tx']:
    txhash = tx['txid']
    print(f"Transaction Hash: {txhash}")
    
    # Inputs
    for vin in tx['vin']:
        if 'coinbase' in vin: 
            continue
        address = vin['address'] if 'address' in vin else "Unknown"
        amount = vin['value'] if 'value' in vin else 0
        index = vin['vout']
        print(f"  Input Address: {address}, Amount: {amount}, Index: {index}")

    # Outputs
    for vout in tx['vout']:
        address = vout['scriptPubKey']['addresses'][0] if 'addresses' in vout['scriptPubKey'] else "Unknown"
        amount = vout['value']
        index = vout['n']
        print(f"  Output Address: {address}, Amount: {amount}, Index: {index}")

    # Fee
    txfee = sum(vin['value'] for vin in tx['vin'] if 'value' in vin) - sum(vout['value'] for vout in tx['vout'])
    print(f"  Transaction Fee: {txfee}")
